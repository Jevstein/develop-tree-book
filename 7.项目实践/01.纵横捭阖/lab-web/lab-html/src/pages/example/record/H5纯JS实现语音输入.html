<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>H5 è¯­éŸ³è¾“å…¥å®Œæ•´è§£å†³æ–¹æ¡ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 6px solid #f39c12;
        }
        
        .warning-banner h2 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning-banner h2:before {
            content: "âš ï¸";
        }
        
        .demo-area {
            margin: 40px 0;
        }
        
        .demo-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }
        
        .demo-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .voice-input-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }
        
        .voice-input {
            width: 100%;
            padding: 15px 20px;
            padding-right: 60px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            min-height: 120px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .voice-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .voice-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s;
            position: relative;
        }
        
        .voice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .voice-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .start-btn {
            background: #27ae60;
            color: white;
        }
        
        .stop-btn {
            background: #e74c3c;
            color: white;
        }
        
        .clear-btn {
            background: #95a5a6;
            color: white;
        }
        
        .listening-indicator {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .listening .listening-indicator {
            display: block;
        }
        
        .pulse {
            width: 20px;
            height: 20px;
            background: #e74c3c;
            border-radius: 50%;
            margin: 0 auto 10px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .compatibility-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .compatibility-table th, .compatibility-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .compatibility-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .compatibility-table tr:last-child td {
            border-bottom: none;
        }
        
        .compatible {
            color: #27ae60;
            font-weight: bold;
        }
        
        .partial {
            color: #f39c12;
            font-weight: bold;
        }
        
        .incompatible {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .voice-records {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
        }
        
        .record-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .record-item:last-child {
            border-bottom: none;
        }
        
        .record-text {
            flex: 1;
            margin-right: 10px;
        }
        
        .record-time {
            font-size: 12px;
            color: #666;
        }
        
        .visualizer {
            width: 100%;
            height: 100px;
            background: #2c3e50;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: #3498db;
            border-radius: 2px 2px 0 0;
        }
        
        .lang-selector {
            margin: 20px 0;
        }
        
        .lang-selector select {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            width: 200px;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .code-block:before {
            content: 'JavaScript ä»£ç ';
            position: relative;
            top: -10px;
            left: 0;
            background: rgba(255,255,255,0.1);
            padding: 5px 20px;
            font-size: 12px;
            color: #aaa;
        }
        
        .audio-wave {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            z-index: -1;
        }
        
        .volume-indicator {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .mic-permission-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 20px 0;
        }
        
        .mic-permission-btn:hover {
            background: #8e44ad;
        }
        
        .permission-status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .permission-granted {
            background: #d4edda;
            color: #155724;
        }
        
        .permission-denied {
            background: #f8d7da;
            color: #721c24;
        }
        
        .permission-prompt {
            background: #fff3cd;
            color: #856404;
        }
        
        .fallback-options {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .fallback-options h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .audio-recorder {
            display: none;
        }
        
        .audio-recorder.active {
            display: block;
        }
        
        .audio-player {
            width: 100%;
            margin: 10px 0;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>H5 è¯­éŸ³è¾“å…¥å®Œæ•´è§£å†³æ–¹æ¡ˆ</h1>
            <p class="subtitle">ä½¿ç”¨ Web Speech API å’Œ MediaRecorder API å®ç°è·¨è®¾å¤‡è¯­éŸ³è¾“å…¥</p>
        </header>
        
        <div class="content">
            <div class="warning-banner">
                <h2>é‡è¦æç¤º</h2>
                <p>è¯­éŸ³è¯†åˆ«åŠŸèƒ½ä¾èµ–äºæµè§ˆå™¨æ”¯æŒï¼ŒChrome å’Œ Edge æ”¯æŒè¾ƒå¥½ï¼ŒiOS Safari æ”¯æŒæœ‰é™ã€‚éœ€è¦åœ¨ HTTPS ç¯å¢ƒä¸‹ä½¿ç”¨ï¼ˆlocalhost é™¤å¤–ï¼‰ã€‚</p>
            </div>
            
            <div class="demo-area">
                <div class="demo-section">
                    <h2>è¯­éŸ³è¾“å…¥æ¼”ç¤º</h2>
                    
                    <div class="voice-input-container" id="voiceContainer">
                        <div class="input-wrapper">
                            <textarea 
                                class="voice-input" 
                                id="voiceInput"
                                placeholder="ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è¯­éŸ³è¾“å…¥ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ­¤è¾“å…¥..."
                            ></textarea>
                        </div>
                        
                        <!-- éº¦å…‹é£æƒé™è¯·æ±‚ -->
                        <div id="permissionArea"></div>
                        
                        <!-- è¯­éŸ³å¯è§†åŒ– -->
                        <div class="visualizer" id="visualizer">
                            <div id="volumeLevel" class="volume-indicator">éŸ³é‡: 0%</div>
                        </div>
                        
                        <!-- è¯­éŸ³æ§åˆ¶æŒ‰é’® -->
                        <div class="voice-controls">
                            <button class="voice-btn start-btn" id="startBtn" title="å¼€å§‹å½•éŸ³">
                                ğŸ¤
                            </button>
                            <button class="voice-btn stop-btn" id="stopBtn" title="åœæ­¢å½•éŸ³" disabled>
                                â¹ï¸
                            </button>
                            <button class="voice-btn clear-btn" id="clearBtn" title="æ¸…ç©ºå†…å®¹">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                        
                        <!-- ç›‘å¬æŒ‡ç¤ºå™¨ -->
                        <div class="listening-indicator" id="listeningIndicator">
                            <div class="pulse"></div>
                            <p>æ­£åœ¨è†å¬ï¼Œè¯·è¯´è¯...</p>
                        </div>
                        
                        <!-- è¯­è¨€é€‰æ‹© -->
                        <div class="lang-selector">
                            <select id="languageSelect">
                                <option value="zh-CN">ä¸­æ–‡ï¼ˆæ™®é€šè¯ï¼‰</option>
                                <option value="en-US">English (US)</option>
                                <option value="ja-JP">æ—¥æœ¬èª</option>
                                <option value="ko-KR">í•œêµ­ì–´</option>
                                <option value="fr-FR">FranÃ§ais</option>
                                <option value="de-DE">Deutsch</option>
                                <option value="es-ES">EspaÃ±ol</option>
                            </select>
                        </div>
                        
                        <!-- å¤‡ç”¨å½•éŸ³æ–¹æ¡ˆ -->
                        <div class="fallback-options">
                            <h3>å¤‡ç”¨å½•éŸ³æ–¹æ¡ˆï¼ˆé€‚ç”¨äºä¸æ”¯æŒ Web Speech API çš„æµè§ˆå™¨ï¼‰</h3>
                            <button id="toggleAudioRecorder" class="mic-permission-btn">
                                åˆ‡æ¢åˆ°éŸ³é¢‘å½•åˆ¶æ¨¡å¼
                            </button>
                            
                            <div class="audio-recorder" id="audioRecorder">
                                <div class="voice-controls">
                                    <button class="voice-btn start-btn" id="startAudioBtn" title="å¼€å§‹å½•éŸ³">
                                        â—
                                    </button>
                                    <button class="voice-btn stop-btn" id="stopAudioBtn" title="åœæ­¢å½•éŸ³" disabled>
                                        â¹ï¸
                                    </button>
                                    <button class="voice-btn clear-btn" id="playAudioBtn" title="æ’­æ”¾å½•éŸ³" disabled>
                                        â–¶ï¸
                                    </button>
                                </div>
                                
                                <audio controls class="audio-player" id="audioPlayer"></audio>
                                
                                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                                    <p>éŸ³é¢‘å½•åˆ¶æ¨¡å¼ä¸‹ï¼Œæ‚¨å¯ä»¥å½•åˆ¶è¯­éŸ³ï¼Œä½†éœ€è¦æ‰‹åŠ¨è½¬æ–‡å­—ã€‚</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- è¯­éŸ³è®°å½• -->
                        <div class="voice-records" id="voiceRecords">
                            <h4 style="margin-bottom: 10px;">è¯­éŸ³è®°å½•</h4>
                            <!-- è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>
                
                <div class="demo-section">
                    <h2>å…¼å®¹æ€§è¡¨æ ¼</h2>
                    <table class="compatibility-table">
                        <thead>
                            <tr>
                                <th>æµè§ˆå™¨/åŠŸèƒ½</th>
                                <th>Web Speech API</th>
                                <th>MediaRecorder API</th>
                                <th>å¤‡æ³¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Chrome (æ¡Œé¢)</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td>æœ€ä½³æ”¯æŒ</td>
                            </tr>
                            <tr>
                                <td>Chrome (Android)</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td>éœ€è¦ç”¨æˆ·æˆæƒ</td>
                            </tr>
                            <tr>
                                <td>Safari (iOS)</td>
                                <td class="incompatible">ä¸æ”¯æŒ</td>
                                <td class="partial">æœ‰é™æ”¯æŒ</td>
                                <td>iOS 14.3+ æ”¯æŒæœ‰é™</td>
                            </tr>
                            <tr>
                                <td>Safari (macOS)</td>
                                <td class="incompatible">ä¸æ”¯æŒ</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td>Safari 14.1+</td>
                            </tr>
                            <tr>
                                <td>Firefox</td>
                                <td class="partial">éƒ¨åˆ†æ”¯æŒ</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td>éœ€å¼€å¯æ ‡å¿—</td>
                            </tr>
                            <tr>
                                <td>Edge</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td class="compatible">æ”¯æŒ</td>
                                <td>åŸºäº Chromium</td>
                            </tr>
                            <tr>
                                <td>å¾®ä¿¡æµè§ˆå™¨</td>
                                <td class="partial">éƒ¨åˆ†æ”¯æŒ</td>
                                <td class="partial">éƒ¨åˆ†æ”¯æŒ</td>
                                <td>å–å†³äºç³»ç»Ÿ WebView</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="demo-section">
                    <h2>å®ç°ä»£ç </h2>
                    <div class="code-block">
// è¯­éŸ³è¯†åˆ«æ§åˆ¶å™¨
class VoiceRecognitionController {
    constructor() {
        this.recognition = null;
        this.isListening = false;
        this.speechSupported = false;
        this.mediaRecorder = null;
        this.audioChunks = [];
        this.isRecording = false;
        this.audioContext = null;
        this.analyser = null;
        this.source = null;
        this.visualizerData = [];
        this.records = [];
        
        this.init();
    }
    
    async init() {
        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        this.checkSupport();
        
        // åˆå§‹åŒ– DOM å…ƒç´ 
        this.initElements();
        
        // æ£€æŸ¥éº¦å…‹é£æƒé™
        await this.checkMicrophonePermission();
        
        // ç»‘å®šäº‹ä»¶
        this.bindEvents();
        
        // åŠ è½½å†å²è®°å½•
        this.loadRecords();
    }
    
    checkSupport() {
        // æ£€æŸ¥ Web Speech API æ”¯æŒ
        this.speechSupported = 'webkitSpeechRecognition' in window || 
                              'SpeechRecognition' in window;
        
        console.log('Web Speech API æ”¯æŒ:', this.speechSupported);
        console.log('MediaRecorder API æ”¯æŒ:', 'MediaRecorder' in window);
        
        this.updateStatus(this.speechSupported ? 
            'æ”¯æŒè¯­éŸ³è¯†åˆ«' : 'ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
    }
    
    initElements() {
        this.elements = {
            voiceInput: document.getElementById('voiceInput'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            clearBtn: document.getElementById('clearBtn'),
            listeningIndicator: document.getElementById('listeningIndicator'),
            languageSelect: document.getElementById('languageSelect'),
            visualizer: document.getElementById('visualizer'),
            volumeLevel: document.getElementById('volumeLevel'),
            voiceContainer: document.getElementById('voiceContainer'),
            permissionArea: document.getElementById('permissionArea'),
            voiceRecords: document.getElementById('voiceRecords'),
            toggleAudioRecorder: document.getElementById('toggleAudioRecorder'),
            audioRecorder: document.getElementById('audioRecorder'),
            startAudioBtn: document.getElementById('startAudioBtn'),
            stopAudioBtn: document.getElementById('stopAudioBtn'),
            playAudioBtn: document.getElementById('playAudioBtn'),
            audioPlayer: document.getElementById('audioPlayer')
        };
    }
    
    async checkMicrophonePermission() {
        try {
            // å°è¯•è·å–éº¦å…‹é£æƒé™çŠ¶æ€
            const permissionStatus = await navigator.permissions.query({ 
                name: 'microphone' 
            });
            
            this.updatePermissionStatus(permissionStatus.state);
            
            // ç›‘å¬æƒé™å˜åŒ–
            permissionStatus.onchange = () => {
                this.updatePermissionStatus(permissionStatus.state);
            };
            
        } catch (error) {
            console.log('ä¸æ”¯æŒæƒé™æŸ¥è¯¢ API');
        }
    }
    
    updatePermissionStatus(status) {
        const permissionArea = this.elements.permissionArea;
        
        let html = '';
        let className = '';
        
        switch(status) {
            case 'granted':
                html = 'âœ… éº¦å…‹é£æƒé™å·²æˆäºˆ';
                className = 'permission-granted';
                break;
            case 'denied':
                html = 'âŒ éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¯ç”¨';
                className = 'permission-denied';
                break;
            case 'prompt':
                html = 'â„¹ï¸ éº¦å…‹é£æƒé™éœ€è¦æˆæƒï¼Œè¯·ç‚¹å‡»å¼€å§‹æŒ‰é’®æˆæƒ';
                className = 'permission-prompt';
                break;
        }
        
        permissionArea.innerHTML = `&lt;div class="permission-status ${className}"&gt;${html}&lt;/div&gt;`;
    }
    
    bindEvents() {
        // è¯­éŸ³è¯†åˆ«æŒ‰é’®äº‹ä»¶
        this.elements.startBtn.addEventListener('click', () => this.startListening());
        this.elements.stopBtn.addEventListener('click', () => this.stopListening());
        this.elements.clearBtn.addEventListener('click', () => this.clearInput());
        
        // è¯­è¨€é€‰æ‹©å˜åŒ–
        this.elements.languageSelect.addEventListener('change', () => {
            if (this.isListening) {
                this.stopListening();
                setTimeout(() => this.startListening(), 300);
            }
        });
        
        // éŸ³é¢‘å½•åˆ¶æŒ‰é’®äº‹ä»¶
        this.elements.toggleAudioRecorder.addEventListener('click', () => {
            this.elements.audioRecorder.classList.toggle('active');
        });
        
        this.elements.startAudioBtn.addEventListener('click', () => this.startAudioRecording());
        this.elements.stopAudioBtn.addEventListener('click', () => this.stopAudioRecording());
        this.elements.playAudioBtn.addEventListener('click', () => this.playAudioRecording());
    }
    
    async startListening() {
        if (!this.speechSupported) {
            alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨');
            return;
        }
        
        try {
            // è¯·æ±‚éº¦å…‹é£æƒé™
            await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
            this.initRecognition();
            
            // å¼€å§‹è¯†åˆ«
            this.recognition.start();
            this.isListening = true;
            
            // æ›´æ–° UI
            this.elements.voiceContainer.classList.add('listening');
            this.elements.startBtn.disabled = true;
            this.elements.stopBtn.disabled = false;
            
            this.updateStatus('æ­£åœ¨è†å¬...');
            
            // å¯åŠ¨å¯è§†åŒ–
            this.startVisualization();
            
        } catch (error) {
            console.error('éº¦å…‹é£è®¿é—®è¢«æ‹’ç»:', error);
            alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®');
        }
    }
    
    initRecognition() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (!SpeechRecognition) {
            throw new Error('SpeechRecognition ä¸æ”¯æŒ');
        }
        
        this.recognition = new SpeechRecognition();
        const lang = this.elements.languageSelect.value;
        
        // é…ç½®è¯†åˆ«å™¨
        this.recognition.lang = lang;
        this.recognition.continuous = true;
        this.recognition.interimResults = true;
        this.recognition.maxAlternatives = 3;
        
        // ç»‘å®šäº‹ä»¶
        this.recognition.onresult = (event) => this.handleRecognitionResult(event);
        this.recognition.onerror = (event) => this.handleRecognitionError(event);
        this.recognition.onend = () => this.handleRecognitionEnd();
        this.recognition.onstart = () => this.updateStatus('è¯­éŸ³è¯†åˆ«å·²å¼€å§‹');
    }
    
    handleRecognitionResult(event) {
        let finalTranscript = '';
        let interimTranscript = '';
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            
            if (event.results[i].isFinal) {
                finalTranscript += transcript;
            } else {
                interimTranscript += transcript;
            }
        }
        
        // æ›´æ–°è¾“å…¥æ¡†
        const currentText = this.elements.voiceInput.value;
        const newText = currentText + (finalTranscript || interimTranscript);
        this.elements.voiceInput.value = newText;
        
        // å¦‚æœæœ‰æœ€ç»ˆç»“æœï¼Œä¿å­˜åˆ°è®°å½•
        if (finalTranscript) {
            this.saveRecord(finalTranscript);
        }
    }
    
    handleRecognitionError(event) {
        console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
        
        let errorMessage = 'è¯­éŸ³è¯†åˆ«é”™è¯¯: ';
        switch(event.error) {
            case 'no-speech':
                errorMessage += 'æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³';
                break;
            case 'audio-capture':
                errorMessage += 'æ— æ³•è®¿é—®éº¦å…‹é£';
                break;
            case 'not-allowed':
                errorMessage += 'éº¦å…‹é£è®¿é—®è¢«æ‹’ç»';
                break;
            default:
                errorMessage += event.error;
        }
        
        this.updateStatus(errorMessage);
        this.stopListening();
    }
    
    handleRecognitionEnd() {
        this.isListening = false;
        this.elements.voiceContainer.classList.remove('listening');
        this.elements.startBtn.disabled = false;
        this.elements.stopBtn.disabled = true;
        
        this.updateStatus('è¯­éŸ³è¯†åˆ«å·²ç»“æŸ');
        this.stopVisualization();
    }
    
    stopListening() {
        if (this.recognition && this.isListening) {
            this.recognition.stop();
        }
    }
    
    clearInput() {
        this.elements.voiceInput.value = '';
    }
    
    async startAudioRecording() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // åˆ›å»º MediaRecorder
            this.mediaRecorder = new MediaRecorder(stream);
            this.audioChunks = [];
            
            this.mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    this.audioChunks.push(event.data);
                }
            };
            
            this.mediaRecorder.onstop = () => {
                const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                const audioUrl = URL.createObjectURL(audioBlob);
                
                this.elements.audioPlayer.src = audioUrl;
                this.elements.playAudioBtn.disabled = false;
                
                this.updateStatus('éŸ³é¢‘å½•åˆ¶å®Œæˆ');
            };
            
            this.mediaRecorder.start();
            this.isRecording = true;
            
            this.elements.startAudioBtn.disabled = true;
            this.elements.stopAudioBtn.disabled = false;
            
            this.updateStatus('æ­£åœ¨å½•åˆ¶éŸ³é¢‘...');
            
        } catch (error) {
            console.error('éŸ³é¢‘å½•åˆ¶å¤±è´¥:', error);
            alert('æ— æ³•è®¿é—®éº¦å…‹é£è¿›è¡Œå½•éŸ³');
        }
    }
    
    stopAudioRecording() {
        if (this.mediaRecorder && this.isRecording) {
            this.mediaRecorder.stop();
            this.isRecording = false;
            
            this.elements.startAudioBtn.disabled = false;
            this.elements.stopAudioBtn.disabled = true;
            
            // åœæ­¢æ‰€æœ‰éŸ³è½¨
            this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
        }
    }
    
    playAudioRecording() {
        this.elements.audioPlayer.play();
    }
    
    async startVisualization() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            this.source = this.audioContext.createMediaStreamSource(stream);
            this.analyser = this.audioContext.createAnalyser();
            
            this.analyser.fftSize = 256;
            this.source.connect(this.analyser);
            
            this.visualize();
            
        } catch (error) {
            console.error('éŸ³é¢‘å¯è§†åŒ–å¤±è´¥:', error);
        }
    }
    
    visualize() {
        if (!this.isListening) return;
        
        const bufferLength = this.analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        
        const draw = () => {
            if (!this.isListening) return;
            
            this.analyser.getByteFrequencyData(dataArray);
            
            // è®¡ç®—å¹³å‡éŸ³é‡
            const average = dataArray.reduce((a, b) => a + b) / bufferLength;
            const volumePercent = Math.round((average / 255) * 100);
            
            // æ›´æ–°éŸ³é‡æŒ‡ç¤ºå™¨
            this.elements.volumeLevel.textContent = `éŸ³é‡: ${volumePercent}%`;
            
            // ç»˜åˆ¶å¯è§†åŒ–
            this.drawVisualizer(dataArray, bufferLength, average);
            
            requestAnimationFrame(draw);
        };
        
        draw();
    }
    
    drawVisualizer(dataArray, bufferLength, average) {
        const visualizer = this.elements.visualizer;
        visualizer.innerHTML = '';
        
        const barWidth = (visualizer.offsetWidth - 20) / bufferLength;
        let barHeight;
        let x = 0;
        
        for (let i = 0; i < bufferLength; i++) {
            barHeight = (dataArray[i] / 255) * visualizer.offsetHeight;
            
            const bar = document.createElement('div');
            bar.className = 'visualizer-bar';
            bar.style.left = x + 'px';
            bar.style.height = barHeight + 'px';
            bar.style.backgroundColor = `hsl(${dataArray[i] % 360}, 100%, 50%)`;
            
            visualizer.appendChild(bar);
            x += barWidth;
        }
    }
    
    stopVisualization() {
        if (this.audioContext) {
            this.audioContext.close();
            this.audioContext = null;
        }
        
        this.elements.visualizer.innerHTML = '';
        this.elements.volumeLevel.textContent = 'éŸ³é‡: 0%';
    }
    
    saveRecord(text) {
        const record = {
            text: text,
            time: new Date().toLocaleTimeString(),
            timestamp: Date.now(),
            lang: this.elements.languageSelect.value
        };
        
        this.records.unshift(record);
        
        // é™åˆ¶æœ€å¤šä¿å­˜ 20 æ¡è®°å½•
        if (this.records.length > 20) {
            this.records.pop();
        }
        
        this.saveRecords();
        this.renderRecords();
    }
    
    renderRecords() {
        const recordsContainer = this.elements.voiceRecords;
        recordsContainer.innerHTML = '&lt;h4 style="margin-bottom: 10px;"&gt;è¯­éŸ³è®°å½•&lt;/h4&gt;';
        
        this.records.forEach(record => {
            const recordElement = document.createElement('div');
            recordElement.className = 'record-item';
            
            recordElement.innerHTML = `
                &lt;div class="record-text"&gt;${record.text}&lt;/div&gt;
                &lt;div class="record-time"&gt;${record.time}&lt;/div&gt;
            `;
            
            recordElement.addEventListener('click', () => {
                this.elements.voiceInput.value = record.text;
            });
            
            recordsContainer.appendChild(recordElement);
        });
    }
    
    saveRecords() {
        localStorage.setItem('voiceRecords', JSON.stringify(this.records));
    }
    
    loadRecords() {
        const saved = localStorage.getItem('voiceRecords');
        if (saved) {
            this.records = JSON.parse(saved);
            this.renderRecords();
        }
    }
    
    updateStatus(message) {
        const statusElement = document.getElementById('statusIndicator');
        if (statusElement) {
            statusElement.textContent = `çŠ¶æ€: ${message}`;
        }
    }
}

// åˆå§‹åŒ–
let voiceController = null;

document.addEventListener('DOMContentLoaded', () => {
    voiceController = new VoiceRecognitionController();
    
    // æ·»åŠ çŠ¶æ€æŒ‡ç¤ºå™¨
    const statusIndicator = document.createElement('div');
    statusIndicator.id = 'statusIndicator';
    statusIndicator.className = 'status-indicator';
    statusIndicator.textContent = 'çŠ¶æ€: å°±ç»ª';
    document.body.appendChild(statusIndicator);
});
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Â© 2023 H5 è¯­éŸ³è¾“å…¥è§£å†³æ–¹æ¡ˆ | æ”¯æŒ Web Speech API å’Œ MediaRecorder API</p>
            <p style="margin-top: 10px; font-size: 12px; color: #999;">
                æç¤ºï¼šåœ¨ HTTPS ç¯å¢ƒä¸‹å¯è·å¾—æœ€ä½³ä½“éªŒï¼ŒiOS è®¾å¤‡æ”¯æŒæœ‰é™
            </p>
        </footer>
    </div>
    
    <script>
        // è¯­éŸ³è¯†åˆ«æ§åˆ¶å™¨
        class VoiceRecognitionController {
            constructor() {
                this.recognition = null;
                this.isListening = false;
                this.speechSupported = false;
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.audioContext = null;
                this.analyser = null;
                this.source = null;
                this.visualizerData = [];
                this.records = [];
                
                this.init();
            }
            
            async init() {
                // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
                this.checkSupport();
                
                // åˆå§‹åŒ– DOM å…ƒç´ 
                this.initElements();
                
                // æ£€æŸ¥éº¦å…‹é£æƒé™
                await this.checkMicrophonePermission();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // åŠ è½½å†å²è®°å½•
                this.loadRecords();
                
                this.updateStatus('è¯­éŸ³è¯†åˆ«å·²å°±ç»ª');
            }
            
            checkSupport() {
                // æ£€æŸ¥ Web Speech API æ”¯æŒ
                this.speechSupported = 'webkitSpeechRecognition' in window || 
                                      'SpeechRecognition' in window;
                
                console.log('Web Speech API æ”¯æŒ:', this.speechSupported);
                console.log('MediaRecorder API æ”¯æŒ:', 'MediaRecorder' in window);
                
                this.updateStatus(this.speechSupported ? 
                    'æ”¯æŒè¯­éŸ³è¯†åˆ«' : 'ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
            }
            
            initElements() {
                this.elements = {
                    voiceInput: document.getElementById('voiceInput'),
                    startBtn: document.getElementById('startBtn'),
                    stopBtn: document.getElementById('stopBtn'),
                    clearBtn: document.getElementById('clearBtn'),
                    listeningIndicator: document.getElementById('listeningIndicator'),
                    languageSelect: document.getElementById('languageSelect'),
                    visualizer: document.getElementById('visualizer'),
                    volumeLevel: document.getElementById('volumeLevel'),
                    voiceContainer: document.getElementById('voiceContainer'),
                    permissionArea: document.getElementById('permissionArea'),
                    voiceRecords: document.getElementById('voiceRecords'),
                    toggleAudioRecorder: document.getElementById('toggleAudioRecorder'),
                    audioRecorder: document.getElementById('audioRecorder'),
                    startAudioBtn: document.getElementById('startAudioBtn'),
                    stopAudioBtn: document.getElementById('stopAudioBtn'),
                    playAudioBtn: document.getElementById('playAudioBtn'),
                    audioPlayer: document.getElementById('audioPlayer')
                };
            }
            
            async checkMicrophonePermission() {
                try {
                    // å°è¯•è·å–éº¦å…‹é£æƒé™çŠ¶æ€
                    if (navigator.permissions && navigator.permissions.query) {
                        const permissionStatus = await navigator.permissions.query({ 
                            name: 'microphone' 
                        });
                        
                        this.updatePermissionStatus(permissionStatus.state);
                        
                        // ç›‘å¬æƒé™å˜åŒ–
                        permissionStatus.onchange = () => {
                            this.updatePermissionStatus(permissionStatus.state);
                        };
                    }
                    
                } catch (error) {
                    console.log('ä¸æ”¯æŒæƒé™æŸ¥è¯¢ API');
                }
            }
            
            updatePermissionStatus(status) {
                const permissionArea = this.elements.permissionArea;
                
                let html = '';
                let className = '';
                
                switch(status) {
                    case 'granted':
                        html = 'âœ… éº¦å…‹é£æƒé™å·²æˆäºˆ';
                        className = 'permission-granted';
                        break;
                    case 'denied':
                        html = 'âŒ éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¯ç”¨';
                        className = 'permission-denied';
                        break;
                    case 'prompt':
                        html = 'â„¹ï¸ éº¦å…‹é£æƒé™éœ€è¦æˆæƒï¼Œè¯·ç‚¹å‡»å¼€å§‹æŒ‰é’®æˆæƒ';
                        className = 'permission-prompt';
                        break;
                    default:
                        html = 'â„¹ï¸ éº¦å…‹é£æƒé™çŠ¶æ€æœªçŸ¥';
                        className = 'permission-prompt';
                }
                
                permissionArea.innerHTML = `<div class="permission-status ${className}">${html}</div>`;
            }
            
            bindEvents() {
                // è¯­éŸ³è¯†åˆ«æŒ‰é’®äº‹ä»¶
                this.elements.startBtn.addEventListener('click', () => this.startListening());
                this.elements.stopBtn.addEventListener('click', () => this.stopListening());
                this.elements.clearBtn.addEventListener('click', () => this.clearInput());
                
                // è¯­è¨€é€‰æ‹©å˜åŒ–
                this.elements.languageSelect.addEventListener('change', () => {
                    if (this.isListening) {
                        this.stopListening();
                        setTimeout(() => this.startListening(), 300);
                    }
                });
                
                // éŸ³é¢‘å½•åˆ¶æŒ‰é’®äº‹ä»¶
                this.elements.toggleAudioRecorder.addEventListener('click', () => {
                    this.elements.audioRecorder.classList.toggle('active');
                });
                
                this.elements.startAudioBtn.addEventListener('click', () => this.startAudioRecording());
                this.elements.stopAudioBtn.addEventListener('click', () => this.stopAudioRecording());
                this.elements.playAudioBtn.addEventListener('click', () => this.playAudioRecording());
            }
            
            async startListening() {
                if (!this.speechSupported) {
                    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨');
                    return;
                }
                
                try {
                    // è¯·æ±‚éº¦å…‹é£æƒé™
                    await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
                    this.initRecognition();
                    
                    // å¼€å§‹è¯†åˆ«
                    this.recognition.start();
                    this.isListening = true;
                    
                    // æ›´æ–° UI
                    this.elements.voiceContainer.classList.add('listening');
                    this.elements.startBtn.disabled = true;
                    this.elements.stopBtn.disabled = false;
                    
                    this.updateStatus('æ­£åœ¨è†å¬...');
                    
                    // å¯åŠ¨å¯è§†åŒ–
                    this.startVisualization();
                    
                } catch (error) {
                    console.error('éº¦å…‹é£è®¿é—®è¢«æ‹’ç»:', error);
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®');
                }
            }
            
            initRecognition() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    throw new Error('SpeechRecognition ä¸æ”¯æŒ');
                }
                
                this.recognition = new SpeechRecognition();
                const lang = this.elements.languageSelect.value;
                
                // é…ç½®è¯†åˆ«å™¨
                this.recognition.lang = lang;
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.maxAlternatives = 3;
                
                // ç»‘å®šäº‹ä»¶
                this.recognition.onresult = (event) => this.handleRecognitionResult(event);
                this.recognition.onerror = (event) => this.handleRecognitionError(event);
                this.recognition.onend = () => this.handleRecognitionEnd();
                this.recognition.onstart = () => this.updateStatus('è¯­éŸ³è¯†åˆ«å·²å¼€å§‹');
            }
            
            handleRecognitionResult(event) {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                // æ›´æ–°è¾“å…¥æ¡†
                const currentText = this.elements.voiceInput.value;
                const newText = currentText + (finalTranscript || interimTranscript);
                this.elements.voiceInput.value = newText;
                
                // å¦‚æœæœ‰æœ€ç»ˆç»“æœï¼Œä¿å­˜åˆ°è®°å½•
                if (finalTranscript) {
                    this.saveRecord(finalTranscript);
                }
            }
            
            handleRecognitionError(event) {
                console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                
                let errorMessage = 'è¯­éŸ³è¯†åˆ«é”™è¯¯: ';
                switch(event.error) {
                    case 'no-speech':
                        errorMessage += 'æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³';
                        break;
                    case 'audio-capture':
                        errorMessage += 'æ— æ³•è®¿é—®éº¦å…‹é£';
                        break;
                    case 'not-allowed':
                        errorMessage += 'éº¦å…‹é£è®¿é—®è¢«æ‹’ç»';
                        break;
                    default:
                        errorMessage += event.error;
                }
                
                this.updateStatus(errorMessage);
                this.stopListening();
            }
            
            handleRecognitionEnd() {
                this.isListening = false;
                this.elements.voiceContainer.classList.remove('listening');
                this.elements.startBtn.disabled = false;
                this.elements.stopBtn.disabled = true;
                
                this.updateStatus('è¯­éŸ³è¯†åˆ«å·²ç»“æŸ');
                this.stopVisualization();
            }
            
            stopListening() {
                if (this.recognition && this.isListening) {
                    this.recognition.stop();
                }
            }
            
            clearInput() {
                this.elements.voiceInput.value = '';
            }
            
            async startAudioRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // åˆ›å»º MediaRecorder
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            this.audioChunks.push(event.data);
                        }
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        this.elements.audioPlayer.src = audioUrl;
                        this.elements.playAudioBtn.disabled = false;
                        
                        this.updateStatus('éŸ³é¢‘å½•åˆ¶å®Œæˆ');
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    
                    this.elements.startAudioBtn.disabled = true;
                    this.elements.stopAudioBtn.disabled = false;
                    
                    this.updateStatus('æ­£åœ¨å½•åˆ¶éŸ³é¢‘...');
                    
                } catch (error) {
                    console.error('éŸ³é¢‘å½•åˆ¶å¤±è´¥:', error);
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£è¿›è¡Œå½•éŸ³');
                }
            }
            
            stopAudioRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    
                    this.elements.startAudioBtn.disabled = false;
                    this.elements.stopAudioBtn.disabled = true;
                    
                    // åœæ­¢æ‰€æœ‰éŸ³è½¨
                    this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                }
            }
            
            playAudioRecording() {
                this.elements.audioPlayer.play();
            }
            
            async startVisualization() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.source = this.audioContext.createMediaStreamSource(stream);
                    this.analyser = this.audioContext.createAnalyser();
                    
                    this.analyser.fftSize = 256;
                    this.source.connect(this.analyser);
                    
                    this.visualize();
                    
                } catch (error) {
                    console.error('éŸ³é¢‘å¯è§†åŒ–å¤±è´¥:', error);
                }
            }
            
            visualize() {
                if (!this.isListening) return;
                
                const bufferLength = this.analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                const draw = () => {
                    if (!this.isListening) return;
                    
                    this.analyser.getByteFrequencyData(dataArray);
                    
                    // è®¡ç®—å¹³å‡éŸ³é‡
                    const average = dataArray.reduce((a, b) => a + b) / bufferLength;
                    const volumePercent = Math.round((average / 255) * 100);
                    
                    // æ›´æ–°éŸ³é‡æŒ‡ç¤ºå™¨
                    this.elements.volumeLevel.textContent = `éŸ³é‡: ${volumePercent}%`;
                    
                    // ç»˜åˆ¶å¯è§†åŒ–
                    this.drawVisualizer(dataArray, bufferLength, average);
                    
                    requestAnimationFrame(draw);
                };
                
                draw();
            }
            
            drawVisualizer(dataArray, bufferLength, average) {
                const visualizer = this.elements.visualizer;
                visualizer.innerHTML = '';
                
                const barWidth = (visualizer.offsetWidth - 20) / bufferLength;
                let barHeight;
                let x = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    barHeight = (dataArray[i] / 255) * visualizer.offsetHeight;
                    
                    const bar = document.createElement('div');
                    bar.className = 'visualizer-bar';
                    bar.style.left = x + 'px';
                    bar.style.height = barHeight + 'px';
                    bar.style.backgroundColor = `hsl(${dataArray[i] % 360}, 100%, 50%)`;
                    
                    visualizer.appendChild(bar);
                    x += barWidth;
                }
            }
            
            stopVisualization() {
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
                
                this.elements.visualizer.innerHTML = '';
                this.elements.volumeLevel.textContent = 'éŸ³é‡: 0%';
            }
            
            saveRecord(text) {
                const record = {
                    text: text,
                    time: new Date().toLocaleTimeString(),
                    timestamp: Date.now(),
                    lang: this.elements.languageSelect.value
                };
                
                this.records.unshift(record);
                
                // é™åˆ¶æœ€å¤šä¿å­˜ 20 æ¡è®°å½•
                if (this.records.length > 20) {
                    this.records.pop();
                }
                
                this.saveRecords();
                this.renderRecords();
            }
            
            renderRecords() {
                const recordsContainer = this.elements.voiceRecords;
                recordsContainer.innerHTML = '<h4 style="margin-bottom: 10px;">è¯­éŸ³è®°å½•</h4>';
                
                this.records.forEach(record => {
                    const recordElement = document.createElement('div');
                    recordElement.className = 'record-item';
                    
                    recordElement.innerHTML = `
                        <div class="record-text">${record.text}</div>
                        <div class="record-time">${record.time}</div>
                    `;
                    
                    recordElement.addEventListener('click', () => {
                        this.elements.voiceInput.value = record.text;
                    });
                    
                    recordsContainer.appendChild(recordElement);
                });
            }
            
            saveRecords() {
                localStorage.setItem('voiceRecords', JSON.stringify(this.records));
            }
            
            loadRecords() {
                const saved = localStorage.getItem('voiceRecords');
                if (saved) {
                    this.records = JSON.parse(saved);
                    this.renderRecords();
                }
            }
            
            updateStatus(message) {
                const statusElement = document.getElementById('statusIndicator');
                if (statusElement) {
                    statusElement.textContent = `çŠ¶æ€: ${message}`;
                }
            }
        }
        
        // åˆå§‹åŒ–
        let voiceController = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            voiceController = new VoiceRecognitionController();
            
            // æ·»åŠ çŠ¶æ€æŒ‡ç¤ºå™¨
            const statusIndicator = document.createElement('div');
            statusIndicator.id = 'statusIndicator';
            statusIndicator.className = 'status-indicator';
            statusIndicator.textContent = 'çŠ¶æ€: å°±ç»ª';
            document.body.appendChild(statusIndicator);
        });
    </script>
</body>
</html>