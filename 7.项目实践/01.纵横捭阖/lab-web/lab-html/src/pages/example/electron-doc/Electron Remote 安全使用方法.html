<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electron Remote æ¨¡å—å®‰å…¨ä½¿ç”¨æŒ‡å—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #f39c12;
        }
        
        .warning-banner h2 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .comparison-table th, .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .comparison-table th {
            background: #f2f2f2;
            font-weight: 600;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .demo-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        @media (max-width: 768px) {
            .demo-area {
                grid-template-columns: 1fr;
            }
        }
        
        .remote-demo, .ipc-demo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .remote-demo {
            border-left: 4px solid #e74c3c;
        }
        
        .ipc-demo {
            border-left: 4px solid #27ae60;
        }
        
        .demo-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .remote-btn {
            background: #e74c3c;
        }
        
        .ipc-btn {
            background: #27ae60;
        }
        
        .demo-result {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-success {
            color: #27ae60;
        }
        
        .log-error {
            color: #e74c3c;
        }
        
        .log-info {
            color: #3498db;
        }
        
        .log-warning {
            color: #e67e22;
        }
        
        .usage-scenarios {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #3498db;
        }
        
        .usage-scenarios h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .scenario {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .scenario h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .migration-guide {
            background: #d4edda;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #28a745;
        }
        
        .migration-guide h2 {
            color: #155724;
            margin-bottom: 15px;
        }
        
        .security-considerations {
            background: #f8d7da;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #dc3545;
        }
        
        .security-considerations h2 {
            color: #721c24;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Electron Remote æ¨¡å—å®‰å…¨ä½¿ç”¨æŒ‡å—</h1>
            <p>å®‰å…¨ä½¿ç”¨ getMediaAccessStatus åŠæ›¿ä»£æ–¹æ¡ˆ</p>
        </header>
        
        <div class="content">
            <div class="warning-banner">
                <h2>âš ï¸ é‡è¦å®‰å…¨è­¦å‘Š</h2>
                <p><strong>Electron çš„ remote æ¨¡å—å·²è¿‡æ—¶</strong>ï¼Œä» Electron 14 å¼€å§‹é»˜è®¤ç¦ç”¨ï¼Œåœ¨ Electron 12 ä¸­æ ‡è®°ä¸ºåºŸå¼ƒã€‚</p>
                <p>å»ºè®®ä½¿ç”¨ IPC é€šä¿¡ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ @electron/remote åŒ…ã€‚</p>
            </div>
            
            <h2>getMediaAccessStatus æ–¹æ³•ä»‹ç»</h2>
            <p><code>getMediaAccessStatus</code> æ˜¯ <code>systemPreferences</code> æ¨¡å—çš„æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥åª’ä½“è®¾å¤‡ï¼ˆæ‘„åƒå¤´ã€éº¦å…‹é£ç­‰ï¼‰çš„è®¿é—®æƒé™çŠ¶æ€ã€‚</p>
            
            <div class="code-block">
// æ–¹æ³•ç­¾å
systemPreferences.getMediaAccessStatus(mediaType: string): Promise&lt;string&gt;

// æ”¯æŒçš„ mediaType å€¼
'camera'     // æ‘„åƒå¤´
'microphone' // éº¦å…‹é£
'screen'     // å±å¹•å½•åˆ¶
            </div>
            
            <div class="demo-area">
                <div class="remote-demo">
                    <h2>ä½¿ç”¨ remote æ¨¡å—ï¼ˆä¸æ¨èï¼‰</h2>
                    <div class="code-block">
// ä¸»è¿›ç¨‹å¯ç”¨ remoteï¼ˆä¸å®‰å…¨ï¼‰
// main.js
const { app, BrowserWindow } = require('electron');

// å¯ç”¨ remote æ¨¡å—ï¼ˆä¸æ¨èï¼‰
app.whenReady().then(() => {
  const mainWindow = new BrowserWindow({
    webPreferences: {
      nodeIntegration: true,
      enableRemoteModule: true, // å¯ç”¨ remote
      contextIsolation: false  // å¿…é¡»ç¦ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
    }
  });
});

// æ¸²æŸ“è¿›ç¨‹
const { remote } = require('electron');
const { systemPreferences } = remote;

// ä½¿ç”¨ getMediaAccessStatus
async function checkMediaAccess() {
  try {
    const cameraStatus = await systemPreferences.getMediaAccessStatus('camera');
    const micStatus = await systemPreferences.getMediaAccessStatus('microphone');
    
    console.log('æ‘„åƒå¤´çŠ¶æ€:', cameraStatus);
    console.log('éº¦å…‹é£çŠ¶æ€:', micStatus);
    
    return { camera: cameraStatus, microphone: micStatus };
  } catch (error) {
    console.error('æ£€æŸ¥åª’ä½“æƒé™å¤±è´¥:', error);
    throw error;
  }
}
                    </div>
                    
                    <div class="demo-controls">
                        <button class="remote-btn" id="test-remote">æµ‹è¯• remote æ–¹å¼</button>
                        <button class="remote-btn" id="test-remote-secure">æµ‹è¯•å®‰å…¨ remote</button>
                    </div>
                    
                    <div class="demo-result" id="remote-result">
                        remote æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                    </div>
                </div>
                
                <div class="ipc-demo">
                    <h2>ä½¿ç”¨ IPC é€šä¿¡ï¼ˆæ¨èï¼‰</h2>
                    <div class="code-block">
// ä¸»è¿›ç¨‹ - main.js
const { app, BrowserWindow, ipcMain, systemPreferences } = require('electron');
const path = require('path');

// å®‰å…¨çš„çª—å£é…ç½®
app.whenReady().then(() => {
  const mainWindow = new BrowserWindow({
    webPreferences: {
      nodeIntegration: false,           // ç¦ç”¨ nodeIntegration
      contextIsolation: true,            // å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
      preload: path.join(__dirname, 'preload.js') // é¢„åŠ è½½è„šæœ¬
    }
  });
});

// å¤„ç†åª’ä½“æƒé™æ£€æŸ¥è¯·æ±‚
ipcMain.handle('get-media-access-status', async (event, mediaType) => {
  // éªŒè¯ mediaType å‚æ•°
  const allowedTypes = ['camera', 'microphone', 'screen'];
  if (!allowedTypes.includes(mediaType)) {
    throw new Error(`ä¸æ”¯æŒçš„åª’ä½“ç±»å‹: ${mediaType}`);
  }
  
  try {
    return await systemPreferences.getMediaAccessStatus(mediaType);
  } catch (error) {
    console.error(`è·å– ${mediaType} æƒé™çŠ¶æ€å¤±è´¥:`, error);
    throw error;
  }
});

// é¢„åŠ è½½è„šæœ¬ - preload.js
const { contextBridge, ipcRenderer } = require('electron');

// å®‰å…¨åœ°æš´éœ² API åˆ°æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electronAPI', {
  getMediaAccessStatus: (mediaType) => 
    ipcRenderer.invoke('get-media-access-status', mediaType)
});

// æ¸²æŸ“è¿›ç¨‹
async function checkMediaAccessSafe() {
  try {
    const cameraStatus = await window.electronAPI.getMediaAccessStatus('camera');
    const micStatus = await window.electronAPI.getMediaAccessStatus('microphone');
    
    console.log('æ‘„åƒå¤´çŠ¶æ€:', cameraStatus);
    console.log('éº¦å…‹é£çŠ¶æ€:', micStatus);
    
    return { camera: cameraStatus, microphone: micStatus };
  } catch (error) {
    console.error('æ£€æŸ¥åª’ä½“æƒé™å¤±è´¥:', error);
    throw error;
  }
}
                    </div>
                    
                    <div class="demo-controls">
                        <button class="ipc-btn" id="test-ipc">æµ‹è¯• IPC æ–¹å¼</button>
                        <button class="ipc-btn" id="test-ipc-bulk">æµ‹è¯•æ‰¹é‡æ£€æŸ¥</button>
                    </div>
                    
                    <div class="demo-result" id="ipc-result">
                        IPC æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                    </div>
                </div>
            </div>
            
            <div class="usage-scenarios">
                <h2>å®Œæ•´å®ç°æ–¹æ¡ˆ</h2>
                
                <div class="scenario">
                    <h3>æ–¹æ¡ˆ1ï¼šä½¿ç”¨ @electron/remoteï¼ˆè¿‡æ¸¡æ–¹æ¡ˆï¼‰</h3>
                    <div class="code-block">
// 1. å®‰è£… @electron/remote
// npm install @electron/remote

// 2. ä¸»è¿›ç¨‹é…ç½® - main.js
const { app, BrowserWindow } = require('electron');
const remote = require('@electron/remote/main');

// åˆå§‹åŒ– remote
remote.initialize();

app.whenReady().then(() => {
  const mainWindow = new BrowserWindow({
    webPreferences: {
      nodeIntegration: true,
      contextIsolation: false, // éœ€è¦ç¦ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
      enableRemoteModule: false // ä½¿ç”¨ @electron/remote æ›¿ä»£
    }
  });
  
  // å¯ç”¨ remote
  remote.enable(mainWindow.webContents);
});

// 3. æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨
const { systemPreferences } = require('@electron/remote');

async function checkMediaAccess() {
  const status = await systemPreferences.getMediaAccessStatus('camera');
  return status;
}
                    </div>
                </div>
                
                <div class="scenario">
                    <h3>æ–¹æ¡ˆ2ï¼šå®‰å…¨çš„ IPC å®ç°ï¼ˆæ¨èï¼‰</h3>
                    <div class="code-block">
// ä¸»è¿›ç¨‹ - main.js
const { app, BrowserWindow, ipcMain, systemPreferences, dialog } = require('electron');
const path = require('path');

class MediaPermissionManager {
  constructor() {
    this.setupIPCHandlers();
  }
  
  setupIPCHandlers() {
    // å•ä¸ªåª’ä½“ç±»å‹æ£€æŸ¥
    ipcMain.handle('media:get-status', async (event, mediaType) => {
      return this.getMediaAccessStatus(mediaType);
    });
    
    // æ‰¹é‡æ£€æŸ¥æ‰€æœ‰åª’ä½“ç±»å‹
    ipcMain.handle('media:get-all-status', async (event) => {
      return this.getAllMediaAccessStatus();
    });
    
    // è¯·æ±‚åª’ä½“æƒé™
    ipcMain.handle('media:request-access', async (event, mediaType) => {
      return this.requestMediaAccess(mediaType, event.sender);
    });
  }
  
  async getMediaAccessStatus(mediaType) {
    // éªŒè¯åª’ä½“ç±»å‹
    const allowedTypes = ['camera', 'microphone', 'screen'];
    if (!allowedTypes.includes(mediaType)) {
      throw new Error(`ä¸æ”¯æŒçš„åª’ä½“ç±»å‹: ${mediaType}`);
    }
    
    try {
      const status = await systemPreferences.getMediaAccessStatus(mediaType);
      return {
        type: mediaType,
        status: status,
        timestamp: new Date().toISOString()
      };
    } catch (error) {
      console.error(`è·å– ${mediaType} æƒé™çŠ¶æ€å¤±è´¥:`, error);
      throw new Error(`æ— æ³•è·å– ${mediaType} æƒé™çŠ¶æ€`);
    }
  }
  
  async getAllMediaAccessStatus() {
    const mediaTypes = ['camera', 'microphone', 'screen'];
    const results = {};
    
    for (const mediaType of mediaTypes) {
      try {
        results[mediaType] = await this.getMediaAccessStatus(mediaType);
      } catch (error) {
        results[mediaType] = { error: error.message };
      }
    }
    
    return results;
  }
  
  async requestMediaAccess(mediaType, webContents) {
    // æ£€æŸ¥å½“å‰çŠ¶æ€
    const currentStatus = await this.getMediaAccessStatus(mediaType);
    
    if (currentStatus.status === 'granted') {
      return { success: true, alreadyGranted: true };
    }
    
    // æ˜¾ç¤ºæƒé™è¯·æ±‚å¯¹è¯æ¡†
    const mediaNames = {
      camera: 'æ‘„åƒå¤´',
      microphone: 'éº¦å…‹é£',
      screen: 'å±å¹•å½•åˆ¶'
    };
    
    const { response } = await dialog.showMessageBox(webContents.getOwnerBrowserWindow(), {
      type: 'question',
      buttons: ['å…è®¸', 'æ‹’ç»'],
      defaultId: 0,
      message: `åº”ç”¨éœ€è¦è®¿é—®æ‚¨çš„${mediaNames[mediaType]}æƒé™`,
      detail: 'æ­¤æƒé™ç”¨äºè§†é¢‘é€šè¯ã€å½•éŸ³æˆ–å±å¹•å…±äº«åŠŸèƒ½'
    });
    
    if (response === 0) {
      // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè§¦å‘ç³»ç»Ÿæƒé™è¯·æ±‚
      // æ³¨æ„ï¼šgetMediaAccessStatus åªæ£€æŸ¥çŠ¶æ€ï¼Œä¸è¯·æ±‚æƒé™
      // å®é™…æƒé™è¯·æ±‚éœ€è¦è°ƒç”¨å…¶ä»– API æˆ–ç”±ç”¨æˆ·æ“ä½œè§¦å‘
      return { 
        success: true, 
        userApproved: true,
        note: 'ç³»ç»Ÿæƒé™å¯¹è¯æ¡†å°†éšåæ˜¾ç¤º'
      };
    } else {
      return { 
        success: false, 
        userApproved: false,
        reason: 'ç”¨æˆ·æ‹’ç»æˆæƒ'
      };
    }
  }
}

// åˆå§‹åŒ–
const mediaManager = new MediaPermissionManager();

// åˆ›å»ºå®‰å…¨çª—å£
app.whenReady().then(() => {
  const mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js')
    }
  });
  
  mainWindow.loadFile('index.html');
});
                    </div>
                </div>
                
                <div class="scenario">
                    <h3>æ–¹æ¡ˆ3ï¼šé¢„åŠ è½½è„šæœ¬é…ç½®</h3>
                    <div class="code-block">
// preload.js - å®‰å…¨çš„ API æš´éœ²
const { contextBridge, ipcRenderer } = require('electron');

// åª’ä½“æƒé™ API
const mediaAPI = {
  // è·å–å•ä¸ªåª’ä½“çŠ¶æ€
  getMediaStatus: (mediaType) => 
    ipcRenderer.invoke('media:get-status', mediaType),
  
  // è·å–æ‰€æœ‰åª’ä½“çŠ¶æ€
  getAllMediaStatus: () => 
    ipcRenderer.invoke('media:get-all-status'),
  
  // è¯·æ±‚åª’ä½“è®¿é—®æƒé™
  requestMediaAccess: (mediaType) => 
    ipcRenderer.invoke('media:request-access', mediaType),
  
  // ç›‘å¬æƒé™å˜åŒ–ï¼ˆå¦‚æœæ”¯æŒï¼‰
  onMediaAccessChanged: (callback) => {
    // æ³¨æ„ï¼šå®é™…å®ç°å¯èƒ½éœ€è¦é¢å¤–çš„ä¸»è¿›ç¨‹äº‹ä»¶
    ipcRenderer.on('media-access-changed', callback);
    
    return () => {
      ipcRenderer.removeListener('media-access-changed', callback);
    };
  }
};

// åº”ç”¨é…ç½® API
const configAPI = {
  getVersion: () => ipcRenderer.invoke('config:get-version'),
  getPlatform: () => process.platform
};

// å®‰å…¨åœ°æš´éœ² API
contextBridge.exposeInMainWorld('electronAPI', {
  media: mediaAPI,
  config: configAPI,
  
  // æ·»åŠ éªŒè¯å’Œè°ƒè¯•æ–¹æ³•
  validateMediaType: (mediaType) => {
    const allowedTypes = ['camera', 'microphone', 'screen'];
    return allowedTypes.includes(mediaType);
  }
});

// æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨ - renderer.js
class MediaAccessManager {
  constructor() {
    this.mediaStates = {};
    this.init();
  }
  
  async init() {
    await this.checkAllMediaAccess();
    this.setupEventListeners();
  }
  
  // æ£€æŸ¥æ‰€æœ‰åª’ä½“æƒé™
  async checkAllMediaAccess() {
    try {
      this.mediaStates = await window.electronAPI.media.getAllMediaStatus();
      this.updateUI();
      return this.mediaStates;
    } catch (error) {
      console.error('æ£€æŸ¥åª’ä½“æƒé™å¤±è´¥:', error);
      this.showError('æ— æ³•æ£€æŸ¥åª’ä½“æƒé™çŠ¶æ€');
      return {};
    }
  }
  
  // æ£€æŸ¥ç‰¹å®šåª’ä½“æƒé™
  async checkMediaAccess(mediaType) {
    if (!window.electronAPI.validateMediaType(mediaType)) {
      throw new Error(`ä¸æ”¯æŒçš„åª’ä½“ç±»å‹: ${mediaType}`);
    }
    
    try {
      const result = await window.electronAPI.media.getMediaStatus(mediaType);
      this.mediaStates[mediaType] = result;
      this.updateUI();
      return result;
    } catch (error) {
      console.error(`æ£€æŸ¥ ${mediaType} æƒé™å¤±è´¥:`, error);
      this.mediaStates[mediaType] = { error: error.message };
      throw error;
    }
  }
  
  // è¯·æ±‚åª’ä½“æƒé™
  async requestMediaAccess(mediaType) {
    if (!window.electronAPI.validateMediaType(mediaType)) {
      throw new Error(`ä¸æ”¯æŒçš„åª’ä½“ç±»å‹: ${mediaType}`);
    }
    
    try {
      const result = await window.electronAPI.media.requestMediaAccess(mediaType);
      
      if (result.success) {
        // é‡æ–°æ£€æŸ¥çŠ¶æ€
        await this.checkMediaAccess(mediaType);
        this.showSuccess(`${mediaType} æƒé™è¯·æ±‚æˆåŠŸ`);
      } else {
        this.showError(`æƒé™è¯·æ±‚è¢«æ‹’ç»: ${result.reason}`);
      }
      
      return result;
    } catch (error) {
      console.error(`è¯·æ±‚ ${mediaType} æƒé™å¤±è´¥:`, error);
      this.showError('æƒé™è¯·æ±‚å¤±è´¥');
      throw error;
    }
  }
  
  // æ›´æ–°ç•Œé¢
  updateUI() {
    // æ›´æ–°æƒé™çŠ¶æ€æ˜¾ç¤º
    for (const [mediaType, state] of Object.entries(this.mediaStates)) {
      const element = document.getElementById(`${mediaType}-status`);
      if (element) {
        if (state.error) {
          element.textContent = `é”™è¯¯: ${state.error}`;
          element.className = 'status-error';
        } else {
          element.textContent = this.getStatusText(state.status);
          element.className = `status-${state.status}`;
        }
      }
    }
  }
  
  getStatusText(status) {
    const statusMap = {
      'granted': 'å·²æˆæƒ',
      'denied': 'å·²æ‹’ç»',
      'restricted': 'å—é™åˆ¶',
      'not-determined': 'æœªå†³å®š'
    };
    
    return statusMap[status] || status;
  }
  
  setupEventListeners() {
    // è®¾ç½®æŒ‰é’®äº‹ä»¶
    document.getElementById('check-camera').addEventListener('click', () => {
      this.checkMediaAccess('camera');
    });
    
    document.getElementById('request-camera').addEventListener('click', () => {
      this.requestMediaAccess('camera');
    });
    
    // å®šæœŸæ£€æŸ¥æƒé™çŠ¶æ€
    setInterval(() => {
      this.checkAllMediaAccess();
    }, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
  }
  
  showError(message) {
    // æ˜¾ç¤ºé”™è¯¯æç¤º
    console.error('åª’ä½“æƒé™é”™è¯¯:', message);
  }
  
  showSuccess(message) {
    // æ˜¾ç¤ºæˆåŠŸæç¤º
    console.log('åª’ä½“æƒé™æˆåŠŸ:', message);
  }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
  window.mediaManager = new MediaAccessManager();
});
                    </div>
                </div>
            </div>
            
            <div class="migration-guide">
                <h2>ä» remote è¿ç§»åˆ° IPC çš„æŒ‡å—</h2>
                
                <h3>è¿ç§»æ­¥éª¤</h3>
                <ol>
                    <li><strong>åˆ†æç°æœ‰ remote ä½¿ç”¨</strong> - è¯†åˆ«æ‰€æœ‰ä½¿ç”¨ remote çš„ä»£ç </li>
                    <li><strong>è®¾è®¡ IPC API</strong> - ä¸ºæ¯ä¸ª remote è°ƒç”¨åˆ›å»ºå¯¹åº”çš„ IPC å¤„ç†ç¨‹åº</li>
                    <li><strong>å®ç°é¢„åŠ è½½è„šæœ¬</strong> - å®‰å…¨åœ°æš´éœ² API åˆ°æ¸²æŸ“è¿›ç¨‹</li>
                    <li><strong>æ›´æ–°æ¸²æŸ“è¿›ç¨‹ä»£ç </strong> - æ›¿æ¢ remote è°ƒç”¨ä¸º IPC è°ƒç”¨</li>
                    <li><strong>åŠ å¼ºå®‰å…¨é…ç½®</strong> - å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»ï¼Œç¦ç”¨ nodeIntegration</li>
                </ol>
                
                <h3>ä»£ç è¿ç§»ç¤ºä¾‹</h3>
                <div class="code-block">
// è¿ç§»å‰ï¼šä½¿ç”¨ remoteï¼ˆä¸å®‰å…¨ï¼‰
const { remote } = require('electron');
const { systemPreferences, dialog, app } = remote;

// å„ç§ remote è°ƒç”¨
const cameraStatus = await systemPreferences.getMediaAccessStatus('camera');
dialog.showErrorBox('é”™è¯¯', 'å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯');
app.quit();

// è¿ç§»åï¼šä½¿ç”¨ IPCï¼ˆå®‰å…¨ï¼‰
// ä¸»è¿›ç¨‹ - æ·»åŠ  IPC å¤„ç†ç¨‹åº
ipcMain.handle('system:get-media-status', (event, mediaType) => {
  return systemPreferences.getMediaAccessStatus(mediaType);
});

ipcMain.handle('dialog:show-error', (event, title, content) => {
  dialog.showErrorBox(title, content);
});

ipcMain.handle('app:quit', () => {
  app.quit();
});

// é¢„åŠ è½½è„šæœ¬ - æš´éœ² API
contextBridge.exposeInMainWorld('electronAPI', {
  getMediaStatus: (mediaType) => ipcRenderer.invoke('system:get-media-status', mediaType),
  showError: (title, content) => ipcRenderer.invoke('dialog:show-error', title, content),
  quitApp: () => ipcRenderer.invoke('app:quit')
});

// æ¸²æŸ“è¿›ç¨‹ - ä½¿ç”¨æ–° API
const cameraStatus = await window.electronAPI.getMediaStatus('camera');
window.electronAPI.showError('é”™è¯¯', 'å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯');
window.electronAPI.quitApp();
                </div>
            </div>
            
            <div class="security-considerations">
                <h2>å®‰å…¨æ³¨æ„äº‹é¡¹</h2>
                
                <h3>å¯ç”¨ remote çš„é£é™©</h3>
                <ul>
                    <li><strong>æ‰©å¤§æ”»å‡»é¢</strong> - æ¸²æŸ“è¿›ç¨‹å¯ä»¥è®¿é—®æ‰€æœ‰ä¸»è¿›ç¨‹æ¨¡å—</li>
                    <li><strong>ä¸Šä¸‹æ–‡éš”ç¦»å¤±æ•ˆ</strong> - å¿…é¡»ç¦ç”¨ä¸Šä¸‹æ–‡éš”ç¦»æ‰èƒ½ä½¿ç”¨ remote</li>
                    <li><strong>ä»£ç æ³¨å…¥é£é™©</strong> - æ¶æ„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ä¸»è¿›ç¨‹æ“ä½œ</li>
                </ul>
                
                <h3>å®‰å…¨é…ç½®å¯¹æ¯”</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>å®‰å…¨ç‰¹æ€§</th>
                            <th>ä½¿ç”¨ remoteï¼ˆä¸å®‰å…¨ï¼‰</th>
                            <th>ä½¿ç”¨ IPCï¼ˆå®‰å…¨ï¼‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ä¸Šä¸‹æ–‡éš”ç¦»</strong></td>
                            <td>å¿…é¡»ç¦ç”¨</td>
                            <td>å¯ä»¥å¯ç”¨</td>
                        </tr>
                        <tr>
                            <td><strong>nodeIntegration</strong></td>
                            <td>é€šå¸¸å¯ç”¨</td>
                            <td>å¯ä»¥ç¦ç”¨</td>
                        </tr>
                        <tr>
                            <td><strong>æ”»å‡»é¢</strong></td>
                            <td>æ•´ä¸ªä¸»è¿›ç¨‹ API</td>
                            <td>æœ‰é™çš„é¢„å®šä¹‰ API</td>
                        </tr>
                        <tr>
                            <td><strong>ä»£ç å®¡æŸ¥</strong></td>
                            <td>éš¾ä»¥å®¡è®¡</td>
                            <td>æ˜ç¡®çš„ API è¾¹ç•Œ</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>å®‰å…¨æœ€ä½³å®è·µ</h3>
                <div class="code-block">
// 1. æ°¸è¿œä¸è¦ä½¿ç”¨è¿™æ ·çš„é…ç½®
new BrowserWindow({
  webPreferences: {
    nodeIntegration: true,
    contextIsolation: false,
    enableRemoteModule: true, // é«˜å±é…ç½®ï¼
    webSecurity: false        // éå¸¸å±é™©ï¼
  }
});

// 2. ä½¿ç”¨å®‰å…¨é…ç½®
new BrowserWindow({
  webPreferences: {
    nodeIntegration: false,           // ç¦ç”¨ Node.js é›†æˆ
    contextIsolation: true,           // å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
    enableRemoteModule: false,        // ç¦ç”¨ remote æ¨¡å—
    webSecurity: true,               // å¯ç”¨ Web å®‰å…¨
    allowRunningInsecureContent: false, // ç¦æ­¢ä¸å®‰å…¨å†…å®¹
    preload: path.join(__dirname, 'preload.js') // ä½¿ç”¨é¢„åŠ è½½è„šæœ¬
  }
});

// 3. åœ¨é¢„åŠ è½½è„šæœ¬ä¸­éªŒè¯å’Œè¿‡æ»¤
contextBridge.exposeInMainWorld('electronAPI', {
  // å®‰å…¨çš„ API - åªæœ‰æ˜ç¡®å…è®¸çš„æ“ä½œ
  getMediaStatus: async (mediaType) => {
    // è¾“å…¥éªŒè¯
    if (!['camera', 'microphone', 'screen'].includes(mediaType)) {
      throw new Error('æ— æ•ˆçš„åª’ä½“ç±»å‹');
    }
    
    return ipcRenderer.invoke('media:get-status', mediaType);
  },
  
  // é™åˆ¶æ•æ„Ÿæ“ä½œ
  quitApp: async () => {
    // å¯ä»¥æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†æˆ–å…¶ä»–ä¿æŠ¤
    const { response } = await dialog.showMessageBox({
      type: 'question',
      buttons: ['é€€å‡º', 'å–æ¶ˆ'],
      message: 'ç¡®å®šè¦é€€å‡ºåº”ç”¨å—ï¼Ÿ'
    });
    
    if (response === 0) {
      return ipcRenderer.invoke('app:quit');
    }
  }
});
                </div>
            </div>
            
            <h2>å®é™…åº”ç”¨ç¤ºä¾‹</h2>
            
            <div class="code-block">
// å®Œæ•´çš„åª’ä½“æƒé™ç®¡ç†ç»„ä»¶
class MediaPermissions extends HTMLElement {
  constructor() {
    super();
    this.mediaStates = {};
    this.attachShadow({ mode: 'open' });
    this.render();
    this.init();
  }
  
  async init() {
    try {
      await this.loadMediaStatus();
      this.setupEventListeners();
    } catch (error) {
      this.showError('åˆå§‹åŒ–åª’ä½“æƒé™ç»„ä»¶å¤±è´¥');
    }
  }
  
  async loadMediaStatus() {
    try {
      this.mediaStates = await window.electronAPI.media.getAllMediaStatus();
      this.render();
    } catch (error) {
      console.error('åŠ è½½åª’ä½“çŠ¶æ€å¤±è´¥:', error);
      this.mediaStates = {
        camera: { error: 'åŠ è½½å¤±è´¥' },
        microphone: { error: 'åŠ è½½å¤±è´¥' },
        screen: { error: 'åŠ è½½å¤±è´¥' }
      };
      this.render();
    }
  }
  
  render() {
    this.shadowRoot.innerHTML = `
      <style>
        .media-permissions {
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          padding: 16px;
          background: #f8f9fa;
        }
        
        .media-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 8px 0;
          border-bottom: 1px solid #e0e0e0;
        }
        
        .media-item:last-child {
          border-bottom: none;
        }
        
        .media-info {
          display: flex;
          align-items: center;
          gap: 8px;
        }
        
        .status-granted { color: #27ae60; }
        .status-denied { color: #e74c3c; }
        .status-restricted { color: #f39c12; }
        .status-not-determined { color: #95a5a6; }
        .status-error { color: #e74c3c; }
        
        button {
          background: #3498db;
          color: white;
          border: none;
          padding: 6px 12px;
          border-radius: 4px;
          cursor: pointer;
        }
        
        button:disabled {
          background: #bdc3c7;
          cursor: not-allowed;
        }
      </style>
      
      <div class="media-permissions">
        <h3>åª’ä½“æƒé™çŠ¶æ€</h3>
        
        <div class="media-item">
          <div class="media-info">
            <span>ğŸ“· æ‘„åƒå¤´</span>
            <span class="status-${this.getMediaStatus('camera')}">
              ${this.getStatusText('camera')}
            </span>
          </div>
          <button id="request-camera">è¯·æ±‚è®¿é—®</button>
        </div>
        
        <div class="media-item">
          <div class="media-info">
            <span>ğŸ¤ éº¦å…‹é£</span>
            <span class="status-${this.getMediaStatus('microphone')}">
              ${this.getStatusText('microphone')}
            </span>
          </div>
          <button id="request-mic">è¯·æ±‚è®¿é—®</button>
        </div>
        
        <div class="media-item">
          <div class="media-info">
            <span>ğŸ–¥ï¸ å±å¹•å½•åˆ¶</span>
            <span class="status-${this.getMediaStatus('screen')}">
              ${this.getStatusText('screen')}
            </span>
          </div>
          <button id="request-screen">è¯·æ±‚è®¿é—®</button>
        </div>
        
        <div style="margin-top: 12px; text-align: center;">
          <button id="refresh-status">åˆ·æ–°çŠ¶æ€</button>
        </div>
      </div>
    `;
  }
  
  getMediaStatus(mediaType) {
    const state = this.mediaStates[mediaType];
    if (!state || state.error) return 'error';
    return state.status || 'not-determined';
  }
  
  getStatusText(mediaType) {
    const state = this.mediaStates[mediaType];
    if (!state) return 'æœªçŸ¥';
    if (state.error) return `é”™è¯¯: ${state.error}`;
    
    const statusMap = {
      'granted': 'å·²æˆæƒ',
      'denied': 'å·²æ‹’ç»', 
      'restricted': 'å—é™åˆ¶',
      'not-determined': 'æœªå†³å®š'
    };
    
    return statusMap[state.status] || state.status;
  }
  
  setupEventListeners() {
    this.shadowRoot.getElementById('refresh-status').addEventListener('click', () => {
      this.loadMediaStatus();
    });
    
    this.shadowRoot.getElementById('request-camera').addEventListener('click', () => {
      this.requestMediaAccess('camera');
    });
    
    this.shadowRoot.getElementById('request-mic').addEventListener('click', () => {
      this.requestMediaAccess('microphone');
    });
    
    this.shadowRoot.getElementById('request-screen').addEventListener('click', () => {
      this.requestMediaAccess('screen');
    });
  }
  
  async requestMediaAccess(mediaType) {
    const button = this.shadowRoot.getElementById(`request-${mediaType}`);
    button.disabled = true;
    button.textContent = 'è¯·æ±‚ä¸­...';
    
    try {
      await window.electronAPI.media.requestMediaAccess(mediaType);
      await this.loadMediaStatus(); // åˆ·æ–°çŠ¶æ€
    } catch (error) {
      this.showError(`è¯·æ±‚ ${mediaType} æƒé™å¤±è´¥`);
    } finally {
      button.disabled = false;
      button.textContent = 'è¯·æ±‚è®¿é—®';
    }
  }
  
  showError(message) {
    // å®ç°é”™è¯¯æç¤º
    console.error(message);
  }
}

// æ³¨å†Œè‡ªå®šä¹‰å…ƒç´ 
customElements.define('media-permissions', MediaPermissions);

// åœ¨ HTML ä¸­ä½¿ç”¨
// &lt;media-permissions&gt;&lt;/media-permissions&gt;
            </div>
        </div>
    </div>

    <script>
        // æ¼”ç¤ºä»£ç 
        class DemoMediaManager {
            constructor() {
                this.mediaStates = {};
                this.init();
            }
            
            async init() {
                // æ¨¡æ‹Ÿåª’ä½“æƒé™çŠ¶æ€
                this.mediaStates = {
                    camera: { status: 'not-determined' },
                    microphone: { status: 'not-determined' },
                    screen: { status: 'not-determined' }
                };
            }
            
            // æ¨¡æ‹Ÿ remote æ–¹å¼
            async simulateRemoteAccess() {
                addLog('remote-result', 'æ¨¡æ‹Ÿ remote æ–¹å¼è·å–åª’ä½“æƒé™çŠ¶æ€...', 'info');
                
                try {
                    // æ¨¡æ‹Ÿ remote è°ƒç”¨
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    const cameraStatus = this.mediaStates.camera.status;
                    const micStatus = this.mediaStates.microphone.status;
                    
                    addLog('remote-result', `æ‘„åƒå¤´çŠ¶æ€: ${cameraStatus}`, 'success');
                    addLog('remote-result', `éº¦å…‹é£çŠ¶æ€: ${micStatus}`, 'success');
                    addLog('remote-result', 'âš ï¸ æ³¨æ„: ä½¿ç”¨ remote å­˜åœ¨å®‰å…¨é£é™©', 'warning');
                    
                } catch (error) {
                    addLog('remote-result', `é”™è¯¯: ${error.message}`, 'error');
                }
            }
            
            // æ¨¡æ‹Ÿå®‰å…¨ remote
            async simulateSecureRemote() {
                addLog('remote-result', 'æ¨¡æ‹Ÿå®‰å…¨ remote æ–¹å¼...', 'info');
                
                try {
                    // æ¨¡æ‹Ÿå‚æ•°éªŒè¯
                    const validateMediaType = (type) => {
                        const allowed = ['camera', 'microphone', 'screen'];
                        if (!allowed.includes(type)) {
                            throw new Error(`æ— æ•ˆçš„åª’ä½“ç±»å‹: ${type}`);
                        }
                        return true;
                    };
                    
                    validateMediaType('camera');
                    
                    await new Promise(resolve => setTimeout(resolve, 150));
                    
                    addLog('remote-result', 'å‚æ•°éªŒè¯é€šè¿‡', 'success');
                    addLog('remote-result', 'æ‰§è¡Œå®‰å…¨ remote è°ƒç”¨', 'success');
                    addLog('remote-result', 'âœ… å®‰å…¨æªæ–½: è¾“å…¥éªŒè¯, é”™è¯¯å¤„ç†', 'success');
                    
                } catch (error) {
                    addLog('remote-result', `å®‰å…¨é”™è¯¯: ${error.message}`, 'error');
                }
            }
            
            // æ¨¡æ‹Ÿ IPC æ–¹å¼
            async simulateIPCAccess() {
                addLog('ipc-result', 'æ¨¡æ‹Ÿ IPC æ–¹å¼è·å–åª’ä½“æƒé™çŠ¶æ€...', 'info');
                
                try {
                    // æ¨¡æ‹Ÿ IPC è°ƒç”¨
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const cameraStatus = this.mediaStates.camera.status;
                    const micStatus = this.mediaStates.microphone.status;
                    
                    addLog('ipc-result', `æ‘„åƒå¤´çŠ¶æ€: ${cameraStatus}`, 'success');
                    addLog('ipc-result', `éº¦å…‹é£çŠ¶æ€: ${micStatus}`, 'success');
                    addLog('ipc-result', 'âœ… å®‰å…¨ç‰¹æ€§: ä¸Šä¸‹æ–‡éš”ç¦», æœ‰é™ API æš´éœ²', 'success');
                    
                } catch (error) {
                    addLog('ipc-result', `é”™è¯¯: ${error.message}`, 'error');
                }
            }
            
            // æ¨¡æ‹Ÿæ‰¹é‡æ£€æŸ¥
            async simulateBulkCheck() {
                addLog('ipc-result', 'æ¨¡æ‹Ÿæ‰¹é‡æ£€æŸ¥æ‰€æœ‰åª’ä½“æƒé™...', 'info');
                
                const mediaTypes = ['camera', 'microphone', 'screen'];
                
                for (const type of mediaTypes) {
                    try {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        const status = this.mediaStates[type].status;
                        
                        addLog('ipc-result', `${type} çŠ¶æ€: ${status}`, 'success');
                    } catch (error) {
                        addLog('ipc-result', `${type} æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                    }
                }
                
                addLog('ipc-result', 'æ‰¹é‡æ£€æŸ¥å®Œæˆ', 'success');
            }
        }
        
        // åˆ›å»ºæ¼”ç¤ºå®ä¾‹
        const demoManager = new DemoMediaManager();
        
        // æ—¥å¿—å‡½æ•°
        function addLog(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }
        
        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.getElementById('test-remote').addEventListener('click', () => {
            document.getElementById('remote-result').innerHTML = '';
            demoManager.simulateRemoteAccess();
        });
        
        document.getElementById('test-remote-secure').addEventListener('click', () => {
            document.getElementById('remote-result').innerHTML = '';
            demoManager.simulateSecureRemote();
        });
        
        document.getElementById('test-ipc').addEventListener('click', () => {
            document.getElementById('ipc-result').innerHTML = '';
            demoManager.simulateIPCAccess();
        });
        
        document.getElementById('test-ipc-bulk').addEventListener('click', () => {
            document.getElementById('ipc-result').innerHTML = '';
            demoManager.simulateBulkCheck();
        });
    </script>
</body>
</html>